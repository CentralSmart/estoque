<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estoque</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{--bg:#0c0c0c;--surf:#161616;--surf2:#202020;--brd:#282828;--acc:#e8f542;--grn:#42f5a7;--red:#f55142;--org:#f5a742;--txt:#efefef;--mut:#666;}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--txt);font-family:'DM Sans',sans-serif;height:100vh;overflow:hidden;}
header{display:flex;align-items:center;justify-content:space-between;padding:15px 26px;border-bottom:1px solid var(--brd);}
.logo{font-family:'Bebas Neue',sans-serif;font-size:1.8rem;letter-spacing:4px;color:var(--acc);}
.logo em{color:var(--txt);font-style:normal;}
.hdr-r{display:flex;align-items:center;gap:12px;}
.sync{display:flex;align-items:center;gap:6px;font-size:.72rem;color:var(--mut);}
.sdot{width:7px;height:7px;border-radius:50%;background:var(--mut);transition:background .3s;}
.sdot.ok{background:var(--grn);}.sdot.err{background:var(--red);}.sdot.busy{background:var(--org);animation:pp 1s infinite;}
@keyframes pp{0%,100%{opacity:1}50%{opacity:.3}}
.btn{display:inline-flex;align-items:center;gap:5px;padding:7px 15px;border-radius:6px;border:none;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:.81rem;font-weight:500;transition:all .13s;}
.btn-acc{background:var(--acc);color:#0c0c0c;}.btn-acc:hover{background:#d4e038;}
.btn-ghost{background:transparent;color:var(--mut);border:1px solid var(--brd);}.btn-ghost:hover{border-color:var(--acc);color:var(--acc);}
.btn-grn{background:var(--grn);color:#0c0c0c;}.btn-grn:hover{background:#2fd490;}
.btn-del{background:none;border:1px solid transparent;color:var(--red);padding:4px 8px;border-radius:5px;cursor:pointer;font-size:.8rem;font-family:'DM Sans',sans-serif;transition:all .13s;}
.btn-del:hover{background:rgba(245,81,66,.12);border-color:var(--red);}
.btn-sm{padding:5px 11px;font-size:.75rem;}
.app{display:flex;height:calc(100vh - 62px);}
.sidebar{width:255px;border-right:1px solid var(--brd);display:flex;flex-direction:column;flex-shrink:0;}
.sb-hd{padding:13px 17px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--brd);}
.sb-lbl{font-size:.63rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--mut);}
.sb-list{flex:1;overflow-y:auto;}
.li{display:flex;align-items:center;gap:7px;padding:10px 17px;cursor:pointer;border-left:3px solid transparent;transition:background .1s;}
.li:hover{background:var(--surf);}.li.active{background:var(--surf);border-left-color:var(--acc);}
.li-info{flex:1;min-width:0;}
.li-name{font-size:.87rem;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.li-sub{font-size:.68rem;color:var(--mut);margin-top:1px;}
.li-badge{background:var(--surf2);color:var(--mut);font-family:'DM Mono',monospace;font-size:.62rem;padding:2px 7px;border-radius:20px;flex-shrink:0;}
.li-del-btn{background:none;border:none;color:var(--mut);cursor:pointer;padding:2px 5px;border-radius:4px;opacity:0;transition:opacity .1s;font-size:.85rem;}
.li:hover .li-del-btn{opacity:1;}.li-del-btn:hover{color:var(--red);}
.main{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.m-hd{padding:16px 26px;border-bottom:1px solid var(--brd);display:flex;align-items:center;justify-content:space-between;gap:12px;flex-shrink:0;}
.title-area{flex:1;}
.etitle{font-family:'Bebas Neue',sans-serif;font-size:1.65rem;letter-spacing:2px;background:none;border:none;color:var(--txt);outline:none;width:100%;}
.etitle::placeholder{color:var(--brd);}
.m-ts{font-size:.68rem;color:var(--mut);margin-top:2px;}
.search{display:flex;align-items:center;background:var(--surf);border:1px solid var(--brd);border-radius:7px;padding:0 11px;gap:7px;transition:border-color .13s;}
.search:focus-within{border-color:var(--acc);}
.search input{background:none;border:none;color:var(--txt);font-family:'DM Sans',sans-serif;font-size:.82rem;padding:8px 0;outline:none;width:175px;}
.search input::placeholder{color:var(--mut);}
.stats{display:flex;padding:0 26px;border-bottom:1px solid var(--brd);flex-shrink:0;}
.st{display:flex;align-items:center;gap:6px;padding:8px 16px 8px 0;font-size:.72rem;color:var(--mut);}
.st strong{font-family:'DM Mono',monospace;color:var(--txt);font-size:.82rem;}
.sd{width:6px;height:6px;border-radius:50%;}
.tbl-wrap{flex:1;overflow-y:auto;padding:0 26px 26px;}
table{width:100%;border-collapse:collapse;margin-top:16px;}
thead tr{border-bottom:2px solid var(--brd);}
th{text-align:left;padding:8px 9px;font-size:.62rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--mut);cursor:pointer;white-space:nowrap;user-select:none;}
th:hover{color:var(--acc);}
td{padding:10px 9px;font-size:.86rem;border-bottom:1px solid var(--brd);vertical-align:middle;}
tr.irow:hover td{background:var(--surf);}
.ii{background:none;border:1px solid transparent;border-radius:4px;color:var(--txt);font-family:inherit;font-size:.86rem;padding:2px 5px;width:100%;outline:none;transition:border-color .12s;}
.ii:focus{border-color:var(--acc);background:var(--surf2);}
.ii.mono{font-family:'DM Mono',monospace;font-size:.76rem;color:var(--mut);}
.qty-wrap{display:flex;align-items:center;gap:7px;}
.qbadge{font-family:'DM Mono',monospace;font-size:.8rem;padding:2px 9px;border-radius:4px;white-space:nowrap;}
.q-ok{background:rgba(66,245,167,.1);color:var(--grn);}.q-low{background:rgba(245,167,66,.1);color:var(--org);}.q-zero{background:rgba(245,81,66,.1);color:var(--red);}
.add-row{display:flex;gap:7px;padding:12px 26px;border-top:1px solid var(--brd);background:var(--surf);align-items:center;flex-shrink:0;flex-wrap:wrap;}
.ai{background:var(--bg);border:1px solid var(--brd);border-radius:6px;color:var(--txt);font-family:'DM Sans',sans-serif;font-size:.82rem;padding:7px 10px;outline:none;transition:border-color .12s;}
.ai:focus{border-color:var(--acc);}.ai::placeholder{color:var(--mut);}
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:13px;color:var(--mut);text-align:center;}
.empty-big{font-family:'Bebas Neue',sans-serif;font-size:2.6rem;letter-spacing:4px;color:var(--brd);}
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.78);z-index:200;align-items:center;justify-content:center;backdrop-filter:blur(4px);}
.overlay.open{display:flex;}
.modal{background:var(--surf);border:1px solid var(--brd);border-radius:12px;padding:26px 28px;width:350px;animation:scIn .18s ease;}
@keyframes scIn{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.modal h3{font-family:'Bebas Neue',sans-serif;font-size:1.35rem;letter-spacing:2px;margin-bottom:16px;}
.mi{width:100%;background:var(--bg);border:1px solid var(--brd);border-radius:7px;color:var(--txt);font-family:'DM Sans',sans-serif;font-size:.87rem;padding:10px 12px;outline:none;margin-bottom:11px;transition:border-color .12s;}
.mi:focus{border-color:var(--acc);}
.modal-btns{display:flex;gap:8px;justify-content:flex-end;}
#toast{position:fixed;bottom:22px;right:22px;background:var(--surf);border:1px solid var(--grn);color:var(--grn);padding:8px 16px;border-radius:7px;font-size:.79rem;font-weight:500;display:none;z-index:999;animation:tUp .18s ease;}
@keyframes tUp{from{opacity:0;transform:translateY(7px)}to{opacity:1;transform:translateY(0)}}
.spin{display:inline-block;width:13px;height:13px;border:2px solid var(--brd);border-top-color:var(--acc);border-radius:50%;animation:rot .6s linear infinite;}
@keyframes rot{to{transform:rotate(360deg)}}
::-webkit-scrollbar{width:4px;}::-webkit-scrollbar-track{background:transparent;}::-webkit-scrollbar-thumb{background:var(--brd);border-radius:10px;}
.row-in{animation:rIn .2s ease;}@keyframes rIn{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>

<header>
  <div class="logo">ESTO<em>QUE</em></div>
  <div class="hdr-r">
    <div class="sync"><span class="sdot" id="sdot"></span><span id="slbl">conectandoâ€¦</span></div>
    <button class="btn btn-ghost btn-sm" onclick="exportCSV()">â¬‡ CSV</button>
    <button class="btn btn-acc" onclick="openModal()">+ Nova Lista</button>
  </div>
</header>

<div class="app">
  <aside class="sidebar">
    <div class="sb-hd">
      <span class="sb-lbl">Listas</span>
      <button class="btn btn-ghost btn-sm" onclick="openModal()">+</button>
    </div>
    <div class="sb-list" id="sbList">
      <div style="padding:20px;text-align:center"><span class="spin"></span></div>
    </div>
  </aside>
  <div class="main" id="mainArea">
    <div class="empty">
      <div class="empty-big">ğŸ“¦</div>
      <p>Selecione ou crie uma lista</p>
      <button class="btn btn-acc" onclick="openModal()">+ Criar lista</button>
    </div>
  </div>
</div>

<div class="overlay" id="overlay">
  <div class="modal">
    <h3>Nova Lista</h3>
    <input class="mi" id="mlName" placeholder="Nome da lista *" maxlength="60">
    <div class="modal-btns">
      <button class="btn btn-ghost" onclick="closeModal()">Cancelar</button>
      <button class="btn btn-acc" onclick="confirmModal()">Criar</button>
    </div>
  </div>
</div>

<div id="toast"></div>

<script>
// â”â” ESTADO â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
let lists=[], active=null, items=[], sCol=null, sDir=1, qSearch='', pollId=null;
const pending={};

// â”â” SYNC DOT â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
function setSync(s){
  document.getElementById('sdot').className='sdot '+s;
  document.getElementById('slbl').textContent=s==='ok'?'sincronizado':s==='err'?'erro de conexÃ£o':'sincronizandoâ€¦';
}

// â”â” HTTP helper â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
async function api(path, opts={}){
  setSync('busy');
  try{
    const r=await fetch(path,{headers:{'Content-Type':'application/json'},...opts,body:opts.body!=null?JSON.stringify(opts.body):undefined});
    if(!r.ok){const t=await r.text().catch(()=>r.statusText);setSync('err');throw new Error(t);}
    const d=await r.json();setSync('ok');return d;
  }catch(e){setSync('err');throw e;}
}

// â”â” LISTAS â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
async function loadLists(silent=false){
  try{
    lists=await api('/api/listas');
    renderSB();
    if(active&&lists.find(l=>l.titulo_lista===active)) await loadItems(active,true);
  }catch(e){if(!silent)toast('Erro: '+e.message,true);}
}

function renderSB(){
  const c=document.getElementById('sbList');
  if(!lists.length){c.innerHTML=`<div style="padding:20px;text-align:center;color:var(--mut);font-size:.77rem">Nenhuma lista ainda</div>`;return;}
  c.innerHTML=lists.map(l=>{
    const sub=`${l.total} iten${l.total!=1?'s':''}`
      +(+l.zerados>0?` Â· <span style="color:var(--red)">${l.zerados} zer.</span>`:'')
      +(+l.baixos>0?` Â· <span style="color:var(--org)">${l.baixos} bx</span>`:'');
    return `<div class="li ${l.titulo_lista===active?'active':''}" onclick="selectList(${J(l.titulo_lista)})">
      <div class="li-info"><div class="li-name">${esc(l.titulo_lista)}</div><div class="li-sub">${sub}</div></div>
      <span class="li-badge">${l.total}</span>
      <button class="li-del-btn" onclick="event.stopPropagation();delList(${J(l.titulo_lista)})">âœ•</button>
    </div>`;
  }).join('');
}

async function selectList(name){active=name;sCol=null;sDir=1;qSearch='';renderSB();await loadItems(name);startPoll();}

async function delList(name){
  if(!confirm(`Excluir "${name}" e todos os itens?`))return;
  try{
    await api('/api/listas/'+encodeURIComponent(name),{method:'DELETE'});
    if(active===name){active=null;stopPoll();document.getElementById('mainArea').innerHTML=`<div class="empty"><div class="empty-big">ğŸ“¦</div><p>Selecione ou crie uma lista</p><button class="btn btn-acc" onclick="openModal()">+ Criar lista</button></div>`;}
    await loadLists();toast('Lista excluÃ­da');
  }catch(e){toast('Erro: '+e.message,true);}
}

async function renameList(oldName,newName){
  if(!newName.trim()||newName===oldName)return;
  try{await api('/api/listas/'+encodeURIComponent(oldName),{method:'PATCH',body:{novoNome:newName.trim()}});active=newName.trim();await loadLists();}
  catch(e){toast('Erro ao renomear',true);}
}

// â”â” ITENS â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
async function loadItems(name,silent=false){
  if(!silent)showSkeleton(name);
  try{items=await api('/api/itens?lista='+encodeURIComponent(name));renderMain(name);}
  catch(e){if(!silent)toast('Erro: '+e.message,true);}
}

async function addItem(){
  if(!active)return;
  const nome=g('ai_name');if(!nome){document.getElementById('ai_name').focus();return;}
  try{
    const row=await api('/api/itens',{method:'POST',body:{titulo_lista:active,nome_produto:nome,quantidade:parseFloat(g('ai_qty'))||0,unidade:g('ai_unit')||'un',minimo:parseFloat(g('ai_min'))||0,codigo:g('ai_code'),nota:g('ai_note')}});
    items.push(row);
    ['ai_name','ai_code','ai_qty','ai_min','ai_unit','ai_note'].forEach(id=>{const el=document.getElementById(id);if(el)el.value='';});
    document.getElementById('ai_name').focus();
    renderMain(active);await loadLists(true);toast('Item adicionado!');
  }catch(e){toast('Erro: '+e.message,true);}
}

async function delItem(id){
  try{await api('/api/itens/'+id,{method:'DELETE'});items=items.filter(i=>i.id!=id);renderMain(active);await loadLists(true);toast('Item removido');}
  catch(e){toast('Erro: '+e.message,true);}
}

function scheduleUpdate(id,field,val){
  const item=items.find(i=>i.id==id);if(!item)return;
  item[field]=(field==='quantidade'||field==='minimo')?(parseFloat(val)||0):val;
  if(pending[id])clearTimeout(pending[id]);
  pending[id]=setTimeout(async()=>{
    try{await api('/api/itens/'+id,{method:'PATCH',body:{[field]:item[field]}});refreshBadge(id);delete pending[id];await loadLists(true);}
    catch(e){console.error(e);}
  },700);
}

// â”â” RENDER â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
function showSkeleton(name){
  document.getElementById('mainArea').innerHTML=`<div class="m-hd"><div class="title-area"><div class="etitle" style="color:var(--mut)">${esc(name)}</div></div></div><div style="display:flex;align-items:center;justify-content:center;height:100%"><span class="spin"></span></div>`;
}

function renderMain(name){
  const meta=lists.find(l=>l.titulo_lista===name)||{};
  const ts=meta.atualizado_em?new Date(meta.atualizado_em).toLocaleString('pt-BR'):'â€”';
  const st=calcStats();
  let vis=[...items];
  if(qSearch){const q=qSearch.toLowerCase();vis=vis.filter(i=>(i.nome_produto||'').toLowerCase().includes(q)||(i.codigo||'').toLowerCase().includes(q)||(i.nota||'').toLowerCase().includes(q));}
  if(sCol){vis.sort((a,b)=>{let va=a[sCol]??'',vb=b[sCol]??'';if(typeof va==='string'){va=va.toLowerCase();vb=vb.toLowerCase();}return va<vb?-sDir:va>vb?sDir:0;});}

  const rows=vis.length?vis.map(item=>{
    const s=status(item);
    return `<tr class="irow row-in">
      <td><input class="ii" value="${esc(item.nome_produto)}" onblur="scheduleUpdate(${item.id},'nome_produto',this.value)"></td>
      <td><input class="ii mono" value="${esc(item.codigo||'')}" style="width:90px" onblur="scheduleUpdate(${item.id},'codigo',this.value)"></td>
      <td><div class="qty-wrap">
        <input class="ii mono" type="number" min="0" value="${item.quantidade}" style="width:68px;text-align:center"
          onblur="scheduleUpdate(${item.id},'quantidade',this.value)" onkeydown="if(event.key==='Enter')this.blur()">
        <span class="qbadge q-${s}" id="qb_${item.id}">${item.quantidade} ${esc(item.unidade||'un')}</span>
      </div></td>
      <td><input class="ii" value="${esc(item.unidade||'un')}" style="width:52px" onblur="scheduleUpdate(${item.id},'unidade',this.value)"></td>
      <td><input class="ii mono" type="number" min="0" value="${item.minimo||0}" style="width:58px;text-align:center" onblur="scheduleUpdate(${item.id},'minimo',this.value)"></td>
      <td><input class="ii" value="${esc(item.nota||'')}" placeholder="â€”" onblur="scheduleUpdate(${item.id},'nota',this.value)"></td>
      <td style="text-align:right"><button class="btn-del" onclick="delItem(${item.id})">âœ•</button></td>
    </tr>`;
  }).join('')
  :`<tr><td colspan="7" style="text-align:center;padding:38px;color:var(--mut)">${qSearch?`Nenhum resultado`:'Nenhum item. Adicione abaixo â†“'}</td></tr>`;

  document.getElementById('mainArea').innerHTML=`
    <div class="m-hd">
      <div class="title-area">
        <input class="etitle" value="${esc(name)}" placeholder="Nome" onblur="renameList(${J(name)},this.value)" maxlength="60">
        <div class="m-ts">Atualizado: ${ts}</div>
      </div>
      <div class="search"><span style="color:var(--mut)">ğŸ”</span><input placeholder="Buscarâ€¦" value="${esc(qSearch)}" oninput="qSearch=this.value;renderMain(${J(name)})"></div>
      <button class="btn btn-ghost btn-sm" onclick="loadItems(${J(name)})" title="Recarregar">â†»</button>
    </div>
    <div class="stats">${statsHTML(st)}</div>
    <div class="tbl-wrap"><table>
      <thead><tr>
        <th onclick="sortBy('nome_produto')">Produto ${si('nome_produto')}</th>
        <th onclick="sortBy('codigo')">CÃ³digo ${si('codigo')}</th>
        <th onclick="sortBy('quantidade')">Quantidade ${si('quantidade')}</th>
        <th>Unid.</th>
        <th onclick="sortBy('minimo')">MÃ­nimo ${si('minimo')}</th>
        <th>Nota</th>
        <th></th>
      </tr></thead>
      <tbody>${rows}</tbody>
    </table></div>
    <div class="add-row">
      <input class="ai" style="flex:1;min-width:140px" id="ai_name" placeholder="Produto *" onkeydown="if(event.key==='Enter')addItem()">
      <input class="ai" style="width:95px" id="ai_code" placeholder="CÃ³digo">
      <input class="ai" style="width:72px" id="ai_qty" placeholder="Qtd" type="number" min="0">
      <input class="ai" style="width:65px" id="ai_min" placeholder="MÃ­n" type="number" min="0" title="Qtd mÃ­nima p/ alerta">
      <input class="ai" style="width:58px" id="ai_unit" placeholder="Unid">
      <input class="ai" style="flex:1;min-width:100px" id="ai_note" placeholder="Nota">
      <button class="btn btn-grn" onclick="addItem()">+ Adicionar</button>
    </div>`;
}

// â”â” STATUS / STATS â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
function status(i){if(i.quantidade<=0)return'zero';if(i.minimo>0&&i.quantidade<=i.minimo)return'low';return'ok';}
function calcStats(){let ok=0,low=0,zero=0;items.forEach(i=>{const s=status(i);s==='ok'?ok++:s==='low'?low++:zero++;});return{total:items.length,ok,low,zero};}
function statsHTML(s){return`
  <div class="st"><span class="sd" style="background:var(--mut)"></span> Total <strong>${s.total}</strong></div>
  <div class="st"><span class="sd" style="background:var(--grn)"></span> OK <strong>${s.ok}</strong></div>
  <div class="st"><span class="sd" style="background:var(--org)"></span> Baixo <strong>${s.low}</strong></div>
  <div class="st"><span class="sd" style="background:var(--red)"></span> Zerado <strong>${s.zero}</strong></div>`;}
function refreshBadge(id){const item=items.find(i=>i.id==id);if(!item)return;const el=document.getElementById('qb_'+id);if(!el)return;el.className='qbadge q-'+status(item);el.textContent=item.quantidade+' '+(item.unidade||'un');}

// â”â” SORT / POLL / MODAL / CSV / UTILS â”â”â”â”â”â”â”
function sortBy(col){sCol===col?sDir*=-1:(sCol=col,sDir=1);renderMain(active);}
function si(col){return sCol!==col?'<span style="opacity:.3">â†•</span>':sDir===1?'â†‘':'â†“';}
function startPoll(){stopPoll();pollId=setInterval(async()=>{if(active)await loadItems(active,true);await loadLists(true);},8000);}
function stopPoll(){if(pollId){clearInterval(pollId);pollId=null;}}
function openModal(){document.getElementById('overlay').classList.add('open');setTimeout(()=>document.getElementById('mlName').focus(),60);}
function closeModal(){document.getElementById('overlay').classList.remove('open');document.getElementById('mlName').value='';}
document.getElementById('overlay').addEventListener('click',e=>{if(e.target===e.currentTarget)closeModal();});
document.getElementById('mlName').addEventListener('keydown',e=>{if(e.key==='Enter')confirmModal();});
async function confirmModal(){
  const name=document.getElementById('mlName').value.trim();if(!name){document.getElementById('mlName').focus();return;}
  closeModal();
  if(!lists.find(l=>l.titulo_lista===name))lists.push({titulo_lista:name,total:0,zerados:0,baixos:0});
  renderSB();await selectList(name);toast(`Lista "${name}" criada!`);
}
function exportCSV(){
  if(!active||!items.length){toast('Nenhum item para exportar',true);return;}
  const rows=[['ID','Produto','CÃ³digo','Quantidade','Unidade','MÃ­nimo','Nota','Status']];
  items.forEach(i=>rows.push([i.id,i.nome_produto,i.codigo||'',i.quantidade,i.unidade||'un',i.minimo||0,i.nota||'',status(i)]));
  const csv=rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""')}"`).join(',')).join('\n');
  const a=document.createElement('a');a.href=URL.createObjectURL(new Blob(['\uFEFF'+csv],{type:'text/csv;charset=utf-8;'}));a.download=active+'.csv';a.click();toast('CSV exportado!');
}
function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function J(s){return JSON.stringify(s);}
function g(id){const el=document.getElementById(id);return el?el.value.trim():'';}
function toast(msg,isErr){const t=document.getElementById('toast');t.textContent=msg;t.style.borderColor=isErr?'var(--red)':'var(--grn)';t.style.color=isErr?'var(--red)':'var(--grn)';t.style.display='block';clearTimeout(t._t);t._t=setTimeout(()=>t.style.display='none',3000);}

// â”â” BOOT â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
loadLists();
</script>
</body>
</html>
